<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Values Assessment | Agora Consulting</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            background: #f8fafc; 
            font-family: system-ui, -apple-system, sans-serif; 
        }
        .chat-message {
            margin-bottom: 16px;
        }
        .user-message {
            display: flex;
            justify-content: flex-end;
        }
        .ai-message {
            display: flex;
            justify-content: flex-start;
        }
        .message-content {
            max-width: 80%;
            padding: 16px;
            border-radius: 8px;
            word-wrap: break-word;
        }
        .user-content {
            background: #2563eb;
            color: white;
            margin-left: 60px;
        }
        .ai-content {
            background: #f3f4f6;
            color: #374151;
            margin-right: 60px;
        }
        .loading-dots {
            display: inline-flex;
            gap: 4px;
        }
        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
            animation: bounce 1.4s ease-in-out infinite both;
        }
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="core-values-app" class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                    <span class="text-2xl">ðŸ¤–</span>
                </div>
                <div>
                    <h1 class="text-2xl font-bold">Core Values Assessment</h1>
                    <p class="text-blue-100">Powered by Agora Consulting</p>
                </div>
            </div>
        </div>

        <!-- Chat Messages -->
        <div id="chat-area" class="h-96 overflow-y-auto p-6">
            <!-- Initial message will be added here -->
        </div>

        <!-- Input Area -->
        <div class="border-t p-4">
            <div class="flex space-x-4">
                <textarea 
                    id="user-input" 
                    placeholder="Share your thoughts..." 
                    class="flex-1 p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    rows="2"
                ></textarea>
                <button 
                    id="send-button"
                    onclick="sendMessage()" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    Send
                </button>
            </div>
        </div>

        <!-- Email Results Section -->
        <div id="email-section" class="border-t bg-gray-50 p-6" style="display: none;">
            <h3 class="text-lg font-semibold mb-4">Complete Your Assessment</h3>
            <div class="space-y-4">
                <p class="text-gray-700">Your personalized Core Values Assessment is ready! To receive your detailed results and schedule a follow-up consultation with an Agora advisor, please provide your contact information:</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Your Email Address *
                        </label>
                        <input
                            type="email"
                            id="user-email"
                            placeholder="your-email@company.com"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Your Phone Number (optional)
                        </label>
                        <input
                            type="tel"
                            id="user-phone"
                            placeholder="(555) 123-4567"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button
                        onclick="submitAssessment()"
                        class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                    >
                        ðŸ“§ Get My Results & Schedule Consultation
                    </button>
                    
                    <div id="submit-status"></div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="bg-gray-50 px-6 py-3 text-sm text-gray-600">
            <div class="flex justify-between items-center">
                <span>Assessment Progress</span>
                <span id="status" class="font-medium">Ready to Begin</span>
            </div>
        </div>
    </div>

    <script>
        let conversationHistory = [];
        let sessionData = {
            personalResponses: [],
            businessResponses: [],
            personalQuestions: 0,
            businessQuestions: 0,
            stage: 'introduction'
        };

        async function callClaude(messages) {
            try {
                const systemPrompt = `You are the Agora Core Values Coach, helping users identify their top personal and business core values through a reflective conversation.

Step 1a: Thank them for taking the time to complete this exercise, and remind them that honest, reflective answers will allow you to provide the best insights. Encourage them to be as detailed as they can.

Step 1b: Ask them their name and what company they work for, or are associated with.

Step 2: Ask 4â€“5 open-ended PERSONAL questions (e.g., "Tell me about a time you were most proud of a decision you made," or "What principles guide your relationships?"). Encourage detailed answers.

Step 3: Ask 4â€“5 open-ended BUSINESS questions (e.g., "What behaviors do you reward in your company?" or "What would your team say your company truly stands for?"). Again, encourage reflection.

Step 4: Analyze responses to determine their dominant value patterns.

Step 5: Output a final list of 5 personal and 5 business core values that best reflect the user. Provide a short rationale under each.

Be conversational and warm, but always professional. Stay focused on surfacing values, not therapy or advice.

Our Agora advisors are Christians and really embody that in our advisory practice, but we aren't preachy or judgmental in any capacity. It's important to know this because many of our clients are also Christian and we, as advisors, encourage them to embody Christ-like values in their business. However, unless the user offers information about their faith, this tool should not bring up the topic.

Guidelines:
- Gently guide users through two distinct but interconnected value discovery journeys: personal and business
- Encourage storytelling and self-reflection in response to open-ended questions
- Analyze qualitative input to interpret values
- Present a concise summary of 5 personal values and 5 business values at the end
- Avoid imposing values or making assumptions without adequate input
- Stay non-judgmental and empathetic in tone
- Make clear distinctions between personal values and business values
- Adapt language and tone to the user's communication style but maintain a respectful, coaching presence
- Refrain from offering opinions or commenting on anything political

When you reach Step 5 (final analysis), format your response as follows:

## YOUR CORE VALUES ASSESSMENT

### PERSONAL CORE VALUES

**1. [Value Name]**
[Brief rationale based on their responses]

**2. [Value Name]**
[Brief rationale based on their responses]

[Continue for all 5 personal values]

### BUSINESS CORE VALUES

**1. [Value Name]**
[Brief rationale based on their responses]

**2. [Value Name]**
[Brief rationale based on their responses]

[Continue for all 5 business values]

---

These insights will be valuable as you work with your Agora advisor to align your leadership approach and prepare your organization for future success.`;

                const response = await fetch('/api/claude', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: messages,
                        systemPrompt: systemPrompt
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error('Error calling Claude:', error);
                return "I apologize, but I'm having trouble connecting to our AI system right now. Please try refreshing the page or contact support if the problem persists.";
            }
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            conversationHistory.push({ role: 'user', content: message });
            input.value = '';
            
            // Show loading
            document.getElementById('send-button').disabled = true;
            addLoadingMessage();
            
            // Get AI response
            const aiResponse = await callClaude(conversationHistory);
            
            // Remove loading and add AI response
            removeLoadingMessage();
            addMessage(aiResponse, 'ai');
            conversationHistory.push({ role: 'assistant', content: aiResponse });
            
            // Check if assessment is complete
            if (aiResponse.includes('CORE VALUES ASSESSMENT')) {
                document.getElementById('status').textContent = 'Assessment Complete';
                document.getElementById('email-section').style.display = 'block';
            } else {
                document.getElementById('status').textContent = 'In Progress';
            }
            
            document.getElementById('send-button').disabled = false;
        }

        function addMessage(content, type) {
            const chatArea = document.getElementById('chat-area');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type}-message`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = `message-content ${type}-content`;
            contentDiv.innerHTML = `<strong>${type === 'user' ? 'ðŸ‘¤ You:' : 'ðŸ¤– AI Coach:'}</strong> ${content}`;
            
            messageDiv.appendChild(contentDiv);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function addLoadingMessage() {
            const chatArea = document.getElementById('chat-area');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-message';
            loadingDiv.className = 'chat-message ai-message';
            loadingDiv.innerHTML = `
                <div class="message-content ai-content">
                    <strong>ðŸ¤– AI Coach:</strong> 
                    <div class="loading-dots">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>
            `;
            chatArea.appendChild(loadingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function removeLoadingMessage() {
            const loadingMessage = document.getElementById('loading-message');
            if (loadingMessage) {
                loadingMessage.remove();
            }
        }

        function submitAssessment() {
            const email = document.getElementById('user-email').value;
            const phone = document.getElementById('user-phone').value;
            
            if (!email) {
                alert('Please enter your email address.');
                return;
            }
            
            const statusDiv = document.getElementById('submit-status');
            statusDiv.innerHTML = '<span class="text-green-600">âœ… Thank you! We will contact you within 24 hours to schedule your personalized consultation and provide your detailed Core Values Assessment results.</span>';
            
            // Here you could send the data to a form service like Formspree, Netlify Forms, etc.
            console.log('Assessment submission:', { email, phone, conversationHistory });
        }

        // Allow Enter key to send message
        document.getElementById('user-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Start the assessment when page loads
        window.addEventListener('load', function() {
            addMessage("Hello! I'm your Core Values Assessment advisor from Agora Consulting. I'm here to help you discover your personal core values and explore your organization's cultural foundation through a thoughtful conversation.\n\nThis assessment typically takes 10-15 minutes and will provide valuable insights for leadership effectiveness and organizational alignment - crucial factors in successful business transitions.\n\nTo get started, could you please tell me your name and your role within your organization?", 'ai');
            conversationHistory.push({
                role: 'assistant',
                content: "Hello! I'm your Core Values Assessment advisor from Agora Consulting. I'm here to help you discover your personal core values and explore your organization's cultural foundation through a thoughtful conversation.\n\nThis assessment typically takes 10-15 minutes and will provide valuable insights for leadership effectiveness and organizational alignment - crucial factors in successful business transitions.\n\nTo get started, could you please tell me your name and your role within your organization?"
            });
        });
    </script>
</body>
</html>
